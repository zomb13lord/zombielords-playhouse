<script>
    // ... (Firebase initialization remains the same) ...

    // ADDED: Listener for the Enter Key on Name Input
    document.getElementById('session-name').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            // Determine if we are renaming or archiving based on the current modal state
            const title = document.getElementById('modal-title').innerText;
            if (title.includes('RENAME')) {
                confirmRename();
            } else {
                confirmArchive();
            }
        }
    });

    // UPDATED: Silent Purge (No clunky browser confirmation)
    async function deleteSession(id) {
        // Immediate visual feedback: fade the row out
        const el = document.querySelector(`[data-id="${id}"]`);
        if (el) el.style.opacity = "0.3";
        
        await db.collection("users").doc(currentUser.uid).collection("sessions").doc(id).delete();
        refreshArchiveList();
    }

    // UPDATED: Dynamic List Generation (Added data-id for easier targeting)
    async function refreshArchiveList() {
        const listDiv = document.getElementById('session-list');
        listDiv.innerHTML = '<p class="text-[9px] animate-pulse text-slate-500 uppercase">Polling Vault...</p>';
        
        const snapshot = await db.collection("users").doc(currentUser.uid).collection("sessions").orderBy("timestamp", "desc").get();
        listDiv.innerHTML = '';

        snapshot.forEach(doc => {
            const data = doc.data();
            const sessionEl = document.createElement('div');
            sessionEl.className = "flex items-center gap-2 mb-2 transition-all duration-300";
            sessionEl.setAttribute('data-id', doc.id);
            
            const loadBtn = document.createElement('button');
            loadBtn.className = "flex-grow text-left p-4 border border-slate-800 hover:border-emerald-500/50 text-[10px] uppercase bg-black/40 transition-all flex justify-between items-center";
            const isTemp = doc.id === "active_session" ? "<span class='text-blood mr-2'>[ACTIVE]</span>" : "";
            loadBtn.innerHTML = `<div>${isTemp}<span class="text-emerald-500 font-bold tracking-widest">${data.name || 'UNNAMED'}</span></div><span class="text-slate-600 text-[8px]">${new Date(data.timestamp?.seconds * 1000).toLocaleDateString()}</span>`;
            loadBtn.onclick = () => { loadSession(data); toggleArchiveList(false); };

            const renBtn = document.createElement('button');
            renBtn.innerHTML = "✎";
            renBtn.className = "p-4 border border-slate-800 text-slate-500 hover:text-emerald-500 hover:border-emerald-500 transition-all";
            renBtn.onclick = (e) => { e.stopPropagation(); triggerRename(doc.id, data.name); };

            const delBtn = document.createElement('button');
            delBtn.innerHTML = "✕";
            delBtn.className = "p-4 border border-slate-800 text-slate-500 hover:text-blood hover:border-blood transition-all";
            delBtn.onclick = (e) => { e.stopPropagation(); deleteSession(doc.id); };

            sessionEl.appendChild(loadBtn);
            sessionEl.appendChild(renBtn);
            sessionEl.appendChild(delBtn);
            listDiv.appendChild(sessionEl);
        });
    }

    // ... (rest of the functions stay the same) ...
</script>
