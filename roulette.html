<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Live Node | Strategic Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        :root { --bg: #020617; --emerald: #10b981; }
        body {
            background-color: var(--bg); background-image: linear-gradient(to bottom, rgba(2, 6, 23, 0.95), rgba(2, 6, 23, 1)), url('https://zomb13lord.github.io/zombielords-playhouse/background.png');
            background-size: cover; color: #f8fafc; font-family: 'JetBrains Mono', monospace;
        }
        .cinzel { font-family: 'Cinzel', serif; }
        .emerald-text { color: var(--emerald); }
        .shard { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(16, 185, 129, 0.1); backdrop-filter: blur(20px); }
        .numpad-btn { background: rgba(0,0,0,0.6); border: 1px solid rgba(16, 185, 129, 0.2); padding: 15px; font-size: 1.2rem; font-weight: bold; transition: 0.2s; }
        .numpad-btn:hover { border-color: var(--emerald); background: var(--emerald); color: black; }
        .history-pill { background: rgba(0,0,0,0.4); border-left: 3px solid var(--emerald); padding: 8px 12px; margin-bottom: 5px; font-size: 10px; }
    </style>
</head>
<body class="p-4 overflow-hidden h-screen flex flex-col">

    <nav class="flex justify-between items-center mb-4 bg-slate-950/60 p-4 border border-emerald-900/20">
        <div class="flex flex-col">
            <span class="cinzel emerald-text text-xs uppercase tracking-widest">Live_Execution_Node</span>
            <span id="active-protocol" class="text-[8px] text-slate-500 uppercase tracking-tighter">Syncing Protocol...</span>
        </div>
        <button onclick="window.location.href='roulette-config.html'" class="text-[9px] border border-emerald-900 px-4 py-2 hover:bg-emerald-900/20 uppercase font-bold">Calibration</button>
    </nav>

    <div class="grid grid-cols-12 gap-4 flex-grow overflow-hidden">
        
        <div class="col-span-3 shard p-4 flex flex-col overflow-hidden">
            <h3 class="text-[9px] cinzel emerald-text mb-4 uppercase tracking-widest border-b border-emerald-900/30 pb-2">Wheel_History</h3>
            <div id="history-log" class="overflow-y-auto flex-grow pr-2">
                </div>
        </div>

        <div class="col-span-9 flex flex-col gap-4">
            <div class="shard p-6 flex justify-around text-center">
                <div><div class="text-[8px] text-slate-500 uppercase">Bankroll</div><div id="hud-bank" class="cinzel emerald-text text-xl">1000.0</div></div>
                <div><div class="text-[8px] text-slate-500 uppercase">Current Bet</div><div id="hud-bet" class="cinzel text-xl">0.0</div></div>
                <div><div class="text-[8px] text-slate-500 uppercase">Last Hit</div><div id="hud-last" class="cinzel text-xl">--</div></div>
            </div>

            <div class="shard p-4 flex-grow grid grid-cols-3 gap-2">
                <button onclick="inputRoll(0)" class="col-span-3 numpad-btn emerald-text" style="border-color: var(--emerald)">0</button>
                <script>
                    for(let i=1; i<=36; i++) {
                        document.write(`<button onclick="inputRoll(${i})" class="numpad-btn">${i}</button>`);
                    }
                </script>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBSUXdz7HqwkENhQqEJLItxYm-LAwkgbmY", authDomain: "zombielords-playhouse.firebaseapp.com", projectId: "zombielords-playhouse", storageBucket: "zombielords-playhouse.firebasestorage.app", messagingSenderId: "795162260246", appId: "1:795162260246:web:97f0361751ac1359b31637" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth(); const db = firebase.firestore();
        let sessionData = null; let rollHistory = [];

        async function initTracker() {
            const user = auth.currentUser;
            const doc = await db.collection("users").doc(user.uid).collection("sessions").doc("active_session").get();
            if (doc.exists) {
                sessionData = doc.data();
                document.getElementById('active-protocol').innerText = `PROTOCOL: ${sessionData.protocol} | UNIT: ${sessionData.unit} | WHEEL: ${sessionData.wheel}`;
            }
        }

        function inputRoll(n) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            rollHistory.unshift({ num: n, time: time });
            document.getElementById('hud-last').innerText = n;
            renderHistory();
        }

        function renderHistory() {
            const log = document.getElementById('history-log');
            log.innerHTML = rollHistory.map(r => `
                <div class="history-pill">
                    <span class="text-emerald-500 font-bold mr-2">#${r.num}</span>
                    <span class="text-slate-600 font-mono">${r.time}</span>
                </div>
            `).join('');
        }

        auth.onAuthStateChanged(user => {
            if (!user) window.location.href = "index.html";
            else initTracker();
        });
    </script>
</body>
</html>
